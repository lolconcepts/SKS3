<script>
$(document).ready(function(){
	$('#hchart').highcharts({
		chart:{
			plotBackgroundColor:null,
			plotBorderWidth:null,
			plotShadow:false
		},
		title:{
			text: 'Attendance Insight'
		},
		tooltip:{
			pointFormat: '{series.name}:<b>{point.percentage:.1f}%</b>'
		},
		plotOptions:{
			pie:{
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels:{
					enabled:true,
					format: '<b>{point.name}</b>: {point.percentage:.1f} %',
					style: {
						color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
					}
				}
			}
		},
		series:[{
			type: 'pie',
			name: 'Popularity',
			data:[
				['Mon', <%=@mon.to_f/@attendances.count.to_f %>],
				['Tue', <%=@tue.to_f/@attendances.count.to_f %>],
				['Wed', <%=@wed.to_f/@attendances.count.to_f %>],
				['Thu', <%=@thu.to_f/@attendances.count.to_f %>],
				['Fri', <%=@fri.to_f/@attendances.count.to_f %>],
				['Sat', <%=@sat.to_f/@attendances.count.to_f %>],
				['Sun', <%=@sun.to_f/@attendances.count.to_f %>]
			]
		}]
	});

});
</script>
<style type="text/css">
	.notify_banner{
		color: white;
	    text-align: center;
	    background: #909090;
	    width: 200px;
	    text-align: center;
	    margin: auto;
	    position: fixed;
	    bottom: 20px;
	    left: 20px;
	    border-radius: 15px;
	    padding: 10px;
	}
	nav a{
		display: inline-block;
		padding: 15px 20px;
		text-decoration: none;
		text-transform: uppercase;
		font-weight: 700;
	}
	#top_left{
	    /* opacity: 0.5; */
	    width: 33%;
	    float: left;
	    margin-left: 10px;
	}
	#top_middle{
		background-color: orange;
		opacity: 0.5;
		width:33%;
		float: left
	}
	#top_right{
	    width: 33%;
	    float: right;
	    text-align: right;
	    margin-right: 10px;
	    margin-bottom: 50px;
	}
	#left_nav{
	    width: 30%;
	    clear: both;
	    position: absolute;
	    width: 100%;
	    top: 75px;
	}
	#right_nav{
		background-color: white; 
		width:64%;
		float:right;
		padding:11px;
	}
	BODY{
		background-image: url(/images/background.png);
    	background-repeat: repeat-x;
    	background-color: #3A3A3A;
    	color: #000000;
    	margin: 0px;
    	padding: 0px;
	}
	li,ul{
		list-style-type: none;
	}
	.notifications{
		clear: left;
	}
	.sideaction{
	    transform: rotate(-90deg);
	    position: absolute;
	    top: 383px;
	    left: -66px;
	    color: #909090;
	}
</style>
<nav class="navbar navbar-expand-lg navbar-dark indigo">
  <a class="navbar-brand" href="#"><img class="logo" src="/images/tnet.png" width="50" height="50"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
    aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarText">
    <ul class="navbar-nav mr-auto">
		<li><i class="fas fa-people-carry"></i><%= link_to('Setup Your Dojo', dojos_path )%></li>
		<li><i class="fas fa-cogs"></i><%= link_to('Configure Ranks', ranks_path )%></li>
		<li><i class="fas fa-users"></i><%= link_to('Manage Students', students_path )%></li>
		<li><i class="fas fa-shopping-cart"></i><%= link_to('Purchase Licenses', 'https://t0urnament.net/product/sidekick-student-license/', target: :_blank )%></li>
    </ul>
    <span class="navbar-text white-text">
       Side Kick&reg; Dashboard
    </span>
  </div>
</nav>


<div class="container">
	<div class="row">
		<div class="col-3">
			<div class="card-header">Licenses</div>
			<div class="card">
				<td>
								<h3>Student Identity Card Licenses</h3>
							</td>
							<td>
								0<meter value=<%= @dojo.meterval %> low="80.0" high="20.0" optimal="50.0" max="100.0"></meter><%=@dojo.max %><br />
								(<%= @dojo.max - @dojo.count %> remaining)
							</td>
			</div>
		</div>
		<div class="col-3">
			<div class="card-header">New Students</div>
			<div class="card">
				<%= studentsGained() %>
			</div>
		</div>
		<div class="col-3">
			<div class="card-header">Lost Students</div>
			<div class="card">
				<%= studentsLost() %>
			</div>
		</div>
		<div class="col-3">
			<div class="card-header">Growth</div>
			<div class="card">
				<%= studentGrowth() %>
			</div>
		</div>
	</div>
		<div class="row">
		<div class="col-3 no-wrap">
			
				<h2 class="motto">Elevate. Your. Dojo.</h2>
			
		</div>
		<div class="col-3">
			<div class="card-header">Top Classes</div>
			<div class="card">
				<% if @attendances.count > 1 %>
					Monday: <%= ((@mon.to_f/@attendances.count.to_f) * 100).round %>%
					Tuesday: <%= ((@tue.to_f/@attendances.count.to_f) * 100).round %>% 
					Wednesday: <%= ((@wed.to_f/@attendances.count.to_f) * 100).round %>%
					Thursday: <%= ((@thu.to_f/@attendances.count.to_f) * 100).round %>% 
					Friday: <%= ((@fri.to_f/@attendances.count.to_f) * 100).round %>% 
					Saturday: <%= ((@sat.to_f/@attendances.count.to_f) * 100).round %>% 
					Sunday: <%= ((@sun.to_f/@attendances.count.to_f) * 100).round %>%
				<% end %> 
			<div id="hchart" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto">
			</div>
			</div>
		</div>
		<div class="col-3">
			<div class="card-header">Notification Center</div>
			<div class="card">
				<h3>Birthdays</h3>
				<ul>
					<% if @birthday_count == 0 %>
						<li>no birthdays this month</li>
					<% else %>
						<% @students.each do |s| %>
						   <% if s.dob != nil %>
							<% if s.dob.month == Time.now.month %>
							<li>
								<% if s.rank.base == "black" %>
									<%= image_tag("/images/blackbelt_belt.png", :height => "25")%>
								<% end %>
								<%= s.first_name %> <%= s.last_name %> (<%= s.dob.month %>/<%= s.dob.day %>) - <%= link_to('Send Note',:controller => "students",:action => "happyBirthday", :id => s.id) %><br />
								</li>
							<% end %> 
						  <% end%>
						<% end %>
						</ul>
					<% end %>
				<h3>Missed Students</h3>
				<ul>
					<% if @missed_count == 0 %>
					<li>everyone is accounted for :)</li>
					<% else %>
						<% @students.each do |s| %>
							<% if s.is_missed %>
							<li>
								<%= s.first_name %> <%= s.last_name %> - <%= link_to('Send Note',:controller => "students",:action => "missme", :id => s.id) %><br/>
							</li>
							<% end %>
						<% end %>
					<% end %>
				</ul>
			</div>
		</div>
		<div class="col-3">
			<div class="card-header text-center border"><h4>Dojo Health</h4></div>
			<div class="card p-2">
				<ul>
					<li><%=image_tag('white-belt-25x25.png')%>White Belt - <%=belt_count("white")%></li>
					<li><%=image_tag('yellow-belt-25x25.png')%>Yellow Belt - <%=belt_count("yellow")%></li>
					<li><%=image_tag('orange-belt-25x25.png')%>Orange Belt - <%=belt_count("orange")%></li>
					<li><%=image_tag('purple-belt-25x25.png')%>Purple Belt - <%=belt_count("purple")%></li>
					<li><%=image_tag('blue-belt-25x25.png')%>Blue Belt - <%=belt_count("blue")%></li>
					<li><%=image_tag('green-belt-25x25.png')%>Green Belt - <%=belt_count("green")%></li>
					<li><%=image_tag('brown-belt-25x25.png')%>Brown Belt - <%=belt_count("brown")%></li>
					<li><%=image_tag('black-belt-25x25.png')%>Black Belt - <%=belt_count("black")%></li>
				</ul>
			</div>
		</div>
	</div>
		<div class="row">
		<div class="col-4">
				<p class= "notify_banner" style="color:white;text-align: center;">
			Welcome to the administration area of Sidekick Server. Here you will be able to do all the things you need. If you have any issues you can always email <%=mail_to('blackbelt@t0urnament.net','Support') %><i class="far fa-life-ring"></i>
		</p>
		</div>
		<div class="col-8 motto medium text-right text-primary">
			Version: <%= @Version %>
		</div>
	</div>
</div>









</div>